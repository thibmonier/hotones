var extend_object=function(e,t){var o;if(e===t)return e;for(o in t)void 0!==t[o]&&(e[o]=t[o]);return e},replace_object=function(e,t){var o;if(e===t)return e;for(o in t)null!=e[o]&&(e[o]=t[o]);return e},array_map=function(e,t){var o,n=Array.prototype.slice.call(arguments,2),i=[],s=e.length;if(Array.prototype.map&&e.map===Array.prototype.map)i=Array.prototype.map.call(e,function(e){var o=n.slice(0);return o.splice(0,0,e),t.apply(this,o)});else for(o=0;o<s;o++)callback_params=n,callback_params.splice(0,0,e[o]),i.push(t.apply(this,callback_params));return i},array_flat=function(e){var t,o=[];for(t=0;t<e.length;t++)o=o.concat(e[t]);return o},coordsToLatLngs=function(e,t){var o=e[0],n=e[1];return t&&(o=e[1],n=e[0]),new google.maps.LatLng(o,n)},arrayToLatLng=function(e,t){var o;for(o=0;o<e.length;o++)e[o]instanceof google.maps.LatLng||(e[o].length>0&&"object"==typeof e[o][0]?e[o]=arrayToLatLng(e[o],t):e[o]=coordsToLatLngs(e[o],t));return e},getElementsByClassName=function(e,t){var o=e.replace(".","");return"jQuery"in this&&t?$("."+o,t)[0]:document.getElementsByClassName(o)[0]},getElementById=function(e,t){e=e.replace("#","");return"jQuery"in window&&t?$("#"+e,t)[0]:document.getElementById(e)},findAbsolutePosition=function(e){var t=0,o=0;if(e.getBoundingClientRect){var n=e.getBoundingClientRect(),i=-(window.scrollX?window.scrollX:window.pageXOffset),s=-(window.scrollY?window.scrollY:window.pageYOffset);return[n.left-i,n.top-s]}if(e.offsetParent)do{t+=e.offsetLeft,o+=e.offsetTop}while(e=e.offsetParent);return[t,o]},GMaps=function(){"use strict";var e=document,t=function(o){if("object"!=typeof window.google||!window.google.maps)return"object"==typeof window.console&&window.console.error&&console.error("Google Maps API is required. Please register the following JavaScript library https://maps.googleapis.com/maps/api/js."),function(){};if(!this)return new t(o);o.zoom=o.zoom||15,o.mapType=o.mapType||"roadmap";var n,i=function(e,t){return void 0===e?t:e},s=this,l=["bounds_changed","center_changed","click","dblclick","drag","dragend","dragstart","idle","maptypeid_changed","projection_changed","resize","tilesloaded","zoom_changed"],a=["mousemove","mouseout","mouseover"],r=["el","lat","lng","mapType","width","height","markerClusterer","enableNewStyle"],p=o.el||o.div,m=o.markerClusterer,c=google.maps.MapTypeId[o.mapType.toUpperCase()],g=new google.maps.LatLng(o.lat,o.lng),h=i(o.zoomControl,!0),d=o.zoomControlOpt||{style:"DEFAULT",position:"TOP_LEFT"},u=d.style||"DEFAULT",f=d.position||"TOP_LEFT",y=i(o.panControl,!0),w=i(o.mapTypeControl,!0),v=i(o.scaleControl,!0),x=i(o.streetViewControl,!0),_=i(_,!0),L={},C={zoom:this.zoom,center:g,mapTypeId:c},b={panControl:y,zoomControl:h,zoomControlOptions:{style:google.maps.ZoomControlStyle[u],position:google.maps.ControlPosition[f]},mapTypeControl:w,scaleControl:v,streetViewControl:x,overviewMapControl:_};if("string"==typeof o.el||"string"==typeof o.div?p.indexOf("#")>-1?this.el=getElementById(p,o.context):this.el=getElementsByClassName.apply(this,[p,o.context]):this.el=p,void 0===this.el||null===this.el)throw"No element defined.";for(window.context_menu=window.context_menu||{},window.context_menu[s.el.id]={},this.controls=[],this.overlays=[],this.layers=[],this.singleLayers={},this.markers=[],this.polylines=[],this.routes=[],this.polygons=[],this.infoWindow=null,this.overlay_el=null,this.zoom=o.zoom,this.registered_events={},this.el.style.width=o.width||this.el.scrollWidth||this.el.offsetWidth,this.el.style.height=o.height||this.el.scrollHeight||this.el.offsetHeight,google.maps.visualRefresh=o.enableNewStyle,n=0;n<r.length;n++)delete o[r[n]];for(1!=o.disableDefaultUI&&(C=extend_object(C,b)),L=extend_object(C,o),n=0;n<l.length;n++)delete L[l[n]];for(n=0;n<a.length;n++)delete L[a[n]];this.map=new google.maps.Map(this.el,L),m&&(this.markerClusterer=m.apply(this,[this.map]));var T=function(e,t){var o="",n=window.context_menu[s.el.id][e];for(var i in n)if(n.hasOwnProperty(i)){var l=n[i];o+='<li><a id="'+e+"_"+i+'" href="#">'+l.title+"</a></li>"}if(getElementById("gmaps_context_menu")){var a=getElementById("gmaps_context_menu");a.innerHTML=o;var r=a.getElementsByTagName("a"),p=r.length;for(i=0;i<p;i++){var m=r[i],c=function(o){o.preventDefault(),n[this.id.replace(e+"_","")].action.apply(s,[t]),s.hideContextMenu()};google.maps.event.clearListeners(m,"click"),google.maps.event.addDomListenerOnce(m,"click",c,!1)}var g=findAbsolutePosition.apply(this,[s.el]),h=g[0]+t.pixel.x-15,d=g[1]+t.pixel.y-15;a.style.left=h+"px",a.style.top=d+"px"}};this.buildContextMenu=function(e,t){if("marker"===e){t.pixel={};var o=new google.maps.OverlayView;o.setMap(s.map),o.draw=function(){var n=o.getProjection(),i=t.marker.getPosition();t.pixel=n.fromLatLngToContainerPixel(i),T(e,t)}}else T(e,t);var n=getElementById("gmaps_context_menu");setTimeout(function(){n.style.display="block"},0)},this.setContextMenu=function(t){window.context_menu[s.el.id][t.control]={};var o,n=e.createElement("ul");for(o in t.options)if(t.options.hasOwnProperty(o)){var i=t.options[o];window.context_menu[s.el.id][t.control][i.name]={title:i.title,action:i.action}}n.id="gmaps_context_menu",n.style.display="none",n.style.position="absolute",n.style.minWidth="100px",n.style.background="white",n.style.listStyle="none",n.style.padding="8px",n.style.boxShadow="2px 2px 6px #ccc",getElementById("gmaps_context_menu")||e.body.appendChild(n);var l=getElementById("gmaps_context_menu");google.maps.event.addDomListener(l,"mouseout",function(e){e.relatedTarget&&this.contains(e.relatedTarget)||window.setTimeout(function(){l.style.display="none"},400)},!1)},this.hideContextMenu=function(){var e=getElementById("gmaps_context_menu");e&&(e.style.display="none")};var k=function(e,t){google.maps.event.addListener(e,t,function(e){null==e&&(e=this),o[t].apply(this,[e]),s.hideContextMenu()})};google.maps.event.addListener(this.map,"zoom_changed",this.hideContextMenu);for(var z=0;z<l.length;z++){(B=l[z])in o&&k(this.map,B)}for(z=0;z<a.length;z++){var B;(B=a[z])in o&&k(this.map,B)}google.maps.event.addListener(this.map,"rightclick",function(e){o.rightclick&&o.rightclick.apply(this,[e]),null!=window.context_menu[s.el.id].map&&s.buildContextMenu("map",e)}),this.refresh=function(){google.maps.event.trigger(this.map,"resize")},this.fitZoom=function(){var e,t=[],o=this.markers.length;for(e=0;e<o;e++)"boolean"==typeof this.markers[e].visible&&this.markers[e].visible&&t.push(this.markers[e].getPosition());this.fitLatLngBounds(t)},this.fitLatLngBounds=function(e){var t,o=e.length,n=new google.maps.LatLngBounds;for(t=0;t<o;t++)n.extend(e[t]);this.map.fitBounds(n)},this.setCenter=function(e,t,o){this.map.panTo(new google.maps.LatLng(e,t)),o&&o()},this.getElement=function(){return this.el},this.zoomIn=function(e){e=e||1,this.zoom=this.map.getZoom()+e,this.map.setZoom(this.zoom)},this.zoomOut=function(e){e=e||1,this.zoom=this.map.getZoom()-e,this.map.setZoom(this.zoom)};var E,P=[];for(E in this.map)"function"!=typeof this.map[E]||this[E]||P.push(E);for(n=0;n<P.length;n++)(function(e,t,o){e[o]=function(){return t[o].apply(t,arguments)}})(this,this.map,P[n])};return t}();