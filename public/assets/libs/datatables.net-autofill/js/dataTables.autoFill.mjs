/*! For license information please see dataTables.autoFill.mjs.LICENSE.txt */
import t from"jquery";import e from"datatables.net";let o=t;var i=0,n=function(t,l){if(!e.versionCheck||!e.versionCheck("1.11"))throw"Warning: AutoFill requires DataTables 1.11 or greater";this.c=o.extend(!0,{},e.defaults.autoFill,n.defaults,l),this.s={dt:new e.Api(t),namespace:".autoFill"+i++,scroll:{},scrollInterval:null,handle:{height:0,width:0},enabled:!1},this.dom={closeButton:o('<div class="dtaf-popover-close">&times;</div>'),handle:o('<div class="dt-autofill-handle"/>'),select:{top:o('<div class="dt-autofill-select top"/>'),right:o('<div class="dt-autofill-select right"/>'),bottom:o('<div class="dt-autofill-select bottom"/>'),left:o('<div class="dt-autofill-select left"/>')},background:o('<div class="dt-autofill-background"/>'),list:o('<div class="dt-autofill-list">'+this.s.dt.i18n("autoFill.info","")+"</div>").attr("aria-modal",!0).attr("role","dialog").append('<div class="dt-autofill-list-items"></div>'),dtScroll:null,offsetParent:null},this._constructor()};o.extend(n.prototype,{enabled:function(){return this.s.enabled},enable:function(t){var e=this;if(!1===t)return this.disable();this.s.enabled=!0,this._focusListener(),this.dom.handle.on("mousedown touchstart",(function(t){return e._mousedown(t),!1})),o(window).on("resize",(function(){o("div.dt-autofill-handle").length>0&&void 0!==e.dom.attachedTo&&e._attach(e.dom.attachedTo)}));let i=function(){e.s.handle={height:!1,width:!1},o(e.dom.handle).css({height:"",width:""}),void 0!==e.dom.attachedTo&&e._attach(e.dom.attachedTo)};return o(window).on("orientationchange",(function(){setTimeout((function(){i(),setTimeout(i,150)}),50)})),this},disable:function(){return this.s.enabled=!1,this._focusListenerRemove(),this},_constructor:function(){var t=this,e=this.s.dt,i=o("div.dataTables_scrollBody",this.s.dt.table().container());e.settings()[0].autoFill=this,i.length&&(this.dom.dtScroll=i,"static"===i.css("position")&&i.css("position","relative")),!1!==this.c.enable&&this.enable(),e.on("destroy.autoFill",(function(){t._focusListenerRemove()}))},_attach:function(t){var e=this.s.dt,i=e.cell(t).index(),n=this.dom.handle,l=this.s.handle;if(i&&-1!==e.columns(this.c.columns).indexes().indexOf(i.column)){this.dom.offsetParent||(this.dom.offsetParent=o(e.table().node()).offsetParent()),l.height&&l.width||(n.appendTo("body"),l.height=n.outerHeight(),l.width=n.outerWidth());var s=this._getPosition(t,this.dom.offsetParent);this.dom.attachedTo=t,n.css({top:s.top+t.offsetHeight-l.height,left:s.left+t.offsetWidth-l.width}).appendTo(this.dom.offsetParent)}else this._detach()},_actionSelector:function(t){var e=this,i=this.s.dt,l=n.actions,s=[];if(o.each(l,(function(e,o){o.available(i,t)&&s.push(e)})),1===s.length&&!1===this.c.alwaysAsk){var a=l[s[0]].execute(i,t);this._update(a,t)}else if(s.length>1||this.c.alwaysAsk){var r=this.dom.list.children("div.dt-autofill-list-items").empty();s.push("cancel"),o.each(s,(function(n,s){r.append(o("<button/>").html(l[s].option(i,t)).append(o('<span class="dt-autofill-button"/>').html(i.i18n("autoFill.button","&gt;"))).on("click",(function(n){if("button"===n.target.nodeName.toLowerCase()){var a=l[s].execute(i,t,o(this).closest("button"));e._update(a,t),e.dom.background.remove(),e.dom.list.remove()}})))})),this.dom.background.appendTo("body"),this.dom.background.one("click",(function(){e.dom.background.remove(),e.dom.list.remove()})),this.dom.list.appendTo("body"),this.c.closeButton&&(this.dom.list.prepend(this.dom.closeButton).addClass(n.classes.closeable),this.dom.closeButton.on("click",(function(){return e.dom.background.click()}))),this.dom.list.css("margin-top",this.dom.list.outerHeight()/2*-1)}},_detach:function(){this.dom.attachedTo=null,this.dom.handle.detach()},_drawSelection:function(t,e){var i=this.s.dt,n=this.s.start,l=o(this.dom.start),s={row:this.c.vertical?i.rows({page:"current"}).nodes().indexOf(t.parentNode):n.row,column:this.c.horizontal?o(t).index():n.column},a=i.column.index("toData",s.column),r=i.row(":eq("+s.row+")",{page:"current"}),d=o(i.cell(r.index(),a).node());if(i.cell(d).any()&&-1!==i.columns(this.c.columns).indexes().indexOf(a)&&-1!==s.row){var c,u,h,f,m,v;this.s.end=s,c=n.row<s.row?l:d,u=n.row<s.row?d:l,h=n.column<s.column?l:d,f=n.column<s.column?d:l,c=this._getPosition(c.get(0)).top,h=this._getPosition(h.get(0)).left,m=this._getPosition(u.get(0)).top+u.outerHeight()-c,v=this._getPosition(f.get(0)).left+f.outerWidth()-h;var p=this.dom.select;p.top.css({top:c,left:h,width:v}),p.left.css({top:c,left:h,height:m}),p.bottom.css({top:c+m,left:h,width:v}),p.right.css({top:c,left:h+v,height:m})}},_editor:function(t){var e=this.s.dt,o=this.c.editor;if(o){for(var i={},n=[],l=o.fields(),s=0,a=t.length;s<a;s++)for(var r=0,d=t[s].length;r<d;r++){var c=t[s][r],u=e.settings()[0].aoColumns[c.index.column],h=u.editField;if(void 0===h)for(var f=u.mData,m=0,v=l.length;m<v;m++){var p=o.field(l[m]);if(p.dataSrc()===f){h=p.name();break}}if(!h)throw"Could not automatically determine field data. Please see https://datatables.net/tn/11";i[h]||(i[h]={});var g=e.row(c.index.row).id();i[h][g]=c.set,n.push(c.index)}o.bubble(n,!1).multiSet(i).submit(null,(function(){o.close()}))}},_emitEvent:function(t,e){this.s.dt.iterator("table",(function(i,n){o(i.nTable).triggerHandler(t+".dt",e)}))},_focusListener:function(){var t=this,e=this.s.dt,i=this.s.namespace,n=null!==this.c.focus?this.c.focus:e.init().keys||e.settings()[0].keytable?"focus":"hover";"focus"===n?e.on("key-focus.autoFill",(function(e,o,i){t._attach(i.node())})).on("key-blur.autoFill",(function(e,o,i){t._detach()})):"click"===n?(o(e.table().body()).on("click"+i,"td, th",(function(e){t._attach(this)})),o(document.body).on("click"+i,(function(i){o(i.target).parents().filter(e.table().body()).length||t._detach()}))):o(e.table().body()).on("mouseenter"+i+" touchstart"+i,"td, th",(function(e){t._attach(this)})).on("mouseleave"+i+"touchend"+i,(function(e){o(e.relatedTarget).hasClass("dt-autofill-handle")||t._detach()}))},_focusListenerRemove:function(){var t=this.s.dt;t.off(".autoFill"),o(t.table().body()).off(this.s.namespace),o(document.body).off(this.s.namespace)},_getPosition:function(t,e){var i,n=t,l=0,s=0;e||(e=o(o(this.s.dt.table().node())[0].offsetParent));do{var a=n.offsetTop,r=n.offsetLeft;if(i=o(n.offsetParent),l+=a+1*parseInt(i.css("border-top-width")||0),s+=r+1*parseInt(i.css("border-left-width")||0),"body"===n.nodeName.toLowerCase())break;n=i.get(0)}while(i.get(0)!==e.get(0));return{top:l,left:s}},_mousedown:function(t){var e=this,i=this.s.dt;this.dom.start=this.dom.attachedTo,this.s.start={row:i.rows({page:"current"}).nodes().indexOf(o(this.dom.start).parent()[0]),column:o(this.dom.start).index()},o(document.body).on("mousemove.autoFill touchmove.autoFill",(function(t){e._mousemove(t),"touchmove"===t.type&&o(document.body).one("touchend.autoFill",(function(){e._detach()}))})).on("mouseup.autoFill touchend.autoFill",(function(t){e._mouseup(t)}));var n=this.dom.select,l=o(i.table().node()).offsetParent();n.top.appendTo(l),n.left.appendTo(l),n.right.appendTo(l),n.bottom.appendTo(l),this._drawSelection(this.dom.start,t),this.dom.handle.css("display","none");var s=this.dom.dtScroll;this.s.scroll={windowHeight:o(window).height(),windowWidth:o(window).width(),dtTop:s?s.offset().top:null,dtLeft:s?s.offset().left:null,dtHeight:s?s.outerHeight():null,dtWidth:s?s.outerWidth():null}},_mousemove:function(t){var e=t.touches&&t.touches.length?document.elementFromPoint(t.touches[0].clientX,t.touches[0].clientY):t.target,o=e.nodeName.toLowerCase();"td"!==o&&"th"!==o||(this._drawSelection(e,t),this._shiftScroll(t))},_mouseup:function(t){o(document.body).off(".autoFill");var i=this,n=this.s.dt,l=this.dom.select;l.top.remove(),l.left.remove(),l.right.remove(),l.bottom.remove(),this.dom.handle.css("display","block");var s=this.s.start,a=this.s.end;if(s.row!==a.row||s.column!==a.column){var r=n.cell(":eq("+s.row+")",s.column+":visible",{page:"current"});if(o("div.DTE",r.node()).length){var d=n.editor();return d.on("submitSuccess.dtaf close.dtaf",(function(){d.off(".dtaf"),setTimeout((function(){i._mouseup(t)}),100)})).on("submitComplete.dtaf preSubmitCancelled.dtaf close.dtaf",(function(){d.off(".dtaf")})),void d.submit()}for(var c=this._range(s.row,a.row),u=this._range(s.column,a.column),h=[],f=n.settings()[0].aoColumns,m=n.columns(this.c.columns).indexes(),v=0;v<c.length;v++)h.push(o.map(u,(function(t){var o=n.row(":eq("+c[v]+")",{page:"current"}),i=n.cell(o.index(),t+":visible"),l=i.data(),s=i.index(),a=f[s.column].editField;if(void 0!==a&&(l=e.util.get(a)(n.row(s.row).data())),-1!==m.indexOf(s.column))return{cell:i,data:l,label:i.data(),index:s}})));this._actionSelector(h),clearInterval(this.s.scrollInterval),this.s.scrollInterval=null}},_range:function(t,e){var o,i=[];if(t<=e)for(o=t;o<=e;o++)i.push(o);else for(o=t;o>=e;o--)i.push(o);return i},_shiftScroll:function(t){var e,o,i,n,l=this,s=this.s.scroll,a=!1,r=65,d=t.type.includes("touch")?t.touches[0].clientX:t.pageX-window.scrollX,c=t.type.includes("touch")?t.touches[0].clientY:t.pageY-window.scrollY,u=d;c<r?e=-5:c>s.windowHeight-r&&(e=5),u<r?o=-5:u>s.windowWidth-r&&(o=5),null!==s.dtTop&&c<s.dtTop+r?i=-5:null!==s.dtTop&&c>s.dtTop+s.dtHeight-r&&(i=5),null!==s.dtLeft&&d<s.dtLeft+r?n=-5:null!==s.dtLeft&&d>s.dtLeft+s.dtWidth-r&&(n=5),e||o||i||n?(s.windowVert=e,s.windowHoriz=o,s.dtVert=i,s.dtHoriz=n,a=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null),!this.s.scrollInterval&&a&&(this.s.scrollInterval=setInterval((function(){if(window.scrollTo(window.scrollX+(s.windowHoriz?s.windowHoriz:0),window.scrollY+(s.windowVert?s.windowVert:0)),s.dtVert||s.dtHoriz){var t=l.dom.dtScroll[0];s.dtVert&&(t.scrollTop+=s.dtVert),s.dtHoriz&&(t.scrollLeft+=s.dtHoriz)}}),20))},_update:function(t,e){if(!1!==t){var o,i=this.s.dt,n=i.columns(this.c.columns).indexes();if(this._emitEvent("preAutoFill",[i,e]),this._editor(e),null!==this.c.update?this.c.update:!this.c.editor){for(var l=0,s=e.length;l<s;l++)for(var a=0,r=e[l].length;a<r;a++)o=e[l][a],-1!==n.indexOf(o.index.column)&&o.cell.data(o.set);i.draw(!1)}this._emitEvent("autoFill",[i,e])}}}),n.actions={increment:{available:function(t,e){var o=e[0][0].label;return!isNaN(o-parseFloat(o))},option:function(t,e){return t.i18n("autoFill.increment",'Increment / decrement each cell by: <input type="number" value="1">')},execute:function(t,e,i){for(var n=1*e[0][0].data,l=1*o("input",i).val(),s=0,a=e.length;s<a;s++)for(var r=0,d=e[s].length;r<d;r++)e[s][r].set=n,n+=l}},fill:{available:function(t,e){return!0},option:function(t,e){return t.i18n("autoFill.fill","Fill all cells with <i>%d</i>",e[0][0].label)},execute:function(t,e,o){for(var i=e[0][0].data,n=0,l=e.length;n<l;n++)for(var s=0,a=e[n].length;s<a;s++)e[n][s].set=i}},fillHorizontal:{available:function(t,e){return e.length>1&&e[0].length>1},option:function(t,e){return t.i18n("autoFill.fillHorizontal","Fill cells horizontally")},execute:function(t,e,o){for(var i=0,n=e.length;i<n;i++)for(var l=0,s=e[i].length;l<s;l++)e[i][l].set=e[i][0].data}},fillVertical:{available:function(t,e){return e.length>1&&e[0].length>1},option:function(t,e){return t.i18n("autoFill.fillVertical","Fill cells vertically")},execute:function(t,e,o){for(var i=0,n=e.length;i<n;i++)for(var l=0,s=e[i].length;l<s;l++)e[i][l].set=e[0][l].data}},cancel:{available:function(){return!1},option:function(t){return t.i18n("autoFill.cancel","Cancel")},execute:function(){return!1}}},n.version="2.7.0",n.defaults={alwaysAsk:!1,closeButton:!0,focus:null,columns:"",enable:!0,update:null,editor:null,vertical:!0,horizontal:!0},n.classes={btn:"btn",closeable:"dtaf-popover-closeable"};var l=o.fn.dataTable.Api;l.register("autoFill()",(function(){return this})),l.register("autoFill().enabled()",(function(){var t=this.context[0];return!!t.autoFill&&t.autoFill.enabled()})),l.register("autoFill().enable()",(function(t){return this.iterator("table",(function(e){e.autoFill&&e.autoFill.enable(t)}))})),l.register("autoFill().disable()",(function(){return this.iterator("table",(function(t){t.autoFill&&t.autoFill.disable()}))})),o(document).on("preInit.dt.autofill",(function(t,i,l){if("dt"===t.namespace){var s=i.oInit.autoFill,a=e.defaults.autoFill;if(s||a){var r=o.extend({},s,a);!1!==s&&new n(i,r)}}})),e.AutoFill=n,o.fn.DataTable.AutoFill=n;export default e;