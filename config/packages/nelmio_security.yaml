nelmio_security:
    # Signed cookies for additional protection
    # Exclude session cookie (PHPSESSID) as it's already managed by Symfony
    signed_cookie:
        names: ['!PHPSESSID']
        hash_algo: sha256

    # X-Frame-Options: Prevents clickjacking attacks
    clickjacking:
        paths:
            '^/.*': DENY  # Deny all framing (most secure)

    # X-Content-Type-Options: Prevents MIME sniffing
    content_type:
        nosniff: true

    # Referrer-Policy: Controls referrer information
    referrer_policy:
        enabled: true
        policies:
            - 'strict-origin-when-cross-origin'

    # Content-Security-Policy: Mitigates XSS attacks
    # Protects against XSS by restricting sources of executable scripts
    csp:
        enabled: true
        compat_headers: true
        hash:
            algorithm: sha256
        report_endpoint:
            log_channel: null
            log_formatter: nelmio_security.csp_report.log_formatter
            log_level: notice
            filters:
                domains: true
                schemes: true
                browser_bugs: true
                injected_scripts: true
            dismiss: []
        # CSP directives configuration
        # Note: nelmio/security-bundle uses 'enforce' and 'report' keys for directives
        enforce:
            default-src:
                - "'self'"
            script-src:
                - "'self'"
                - "'unsafe-inline'"  # Needed for Chart.js and inline handlers
                - "cdn.jsdelivr.net"
                - "'unsafe-eval'"    # Needed for some Chart.js features
                - "www.googletagmanager.com"  # Google Tag Manager
                - "www.google-analytics.com"  # Google Analytics
                - "*.googletagmanager.com"    # GTM subdomains
                - "unpkg.com"
            style-src:
                - "'self'"
                - "'unsafe-inline'"  # Needed for Bootstrap
                - "cdn.jsdelivr.net"
                - "fonts.googleapis.com"  # Google Fonts CSS
                - "unpkg.com"
            img-src:
                - "'self'"
                - "data:"
                - "blob:"
                - "www.googletagmanager.com"  # GTM pixels
                - "www.google-analytics.com"  # GA pixels
                - "*.r2.dev"                  # Cloudflare R2 CDN
                - "*.r2.cloudflarestorage.com"  # Cloudflare R2 storage
                - "picsum.photos"
                - "*.picsum.photos"              # Picsum images
            font-src:
                - "'self'"
                - "data:"
                - "fonts.gstatic.com"  # Google Fonts files
                - "fonts.googleapis.com"  # Google Fonts files (fallback)
                - "cdn.jsdelivr.net" # Bootstrap fonts
            connect-src:
                - "'self'"
                - "www.googletagmanager.com"  # GTM API calls
                - "www.google-analytics.com"  # GA API calls
                - "*.r2.dev"                  # Cloudflare R2 CDN
                - "*.r2.cloudflarestorage.com"  # Cloudflare R2 storage
                - "cdn.jsdelivr.net"
            frame-ancestors:
                - "'none'"
            base-uri:
                - "'self'"
            form-action:
                - "'self'"
            object-src:
                - "'none'"
            upgrade-insecure-requests: true  # Upgrade HTTP to HTTPS automatically
            block-all-mixed-content: true    # Block mixed content (HTTP on HTTPS page)
            report-uri:
                - "/csp/report"  # Endpoint for CSP violation reports

    # HSTS: Force HTTPS (disabled by default, enabled in prod config)
    forced_ssl:
        enabled: false  # Overridden to true in config/packages/prod/nelmio_security.yaml
        hsts_max_age: 31536000  # 1 an (valeur recommand√©e)
        hsts_subdomains: true   # Appliquer aux sous-domaines
        hsts_preload: true      # Eligible pour HSTS preload list

    # Permissions-Policy: Controls browser features and APIs
    permissions_policy:
        enabled: true
        policies:
            camera: []          # Deny all (no camera access)
            microphone: []      # Deny all (no microphone access)
            geolocation: []     # Deny all (no geolocation)
            payment: []         # Deny all (no payment API)
            usb: []             # Deny all (no USB access)
            # fullscreen: ['self']  # Allow fullscreen from same origin if needed
