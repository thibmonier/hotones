{% extends 'blog/base.html.twig' %}

{% block title %}{{ post.title }} | Blog HotOnes{% endblock %}

{% block meta_description %}{{ post.excerpt }}{% endblock %}

{% block og_type %}article{% endblock %}
{% block og_title %}{{ post.title }}{% endblock %}
{% block og_image %}{{ post.featuredImage ? post.featuredImage : absolute_url(asset('favicon.svg')) }}{% endblock %}

{% block twitter_card %}summary_large_image{% endblock %}

{% block head_scripts %}
    {{ parent() }}
    {# JSON-LD Structured Data for Article #}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": "{{ post.title|escape('js') }}",
        "description": "{{ post.excerpt|escape('js') }}",
        "image": "{{ post.featuredImage ? post.featuredImage : absolute_url(asset('favicon.svg')) }}",
        "datePublished": "{{ post.publishedAt|date('c') }}",
        "dateModified": "{{ post.updatedAt|date('c') }}",
        "author": {
            "@type": "Person",
            "name": "{{ post.author.fullName|escape('js') }}"
        },
        "publisher": {
            "@type": "Organization",
            "name": "HotOnes",
            "logo": {
                "@type": "ImageObject",
                "url": "{{ absolute_url(asset('favicon.svg')) }}"
            }
        }
    }
    </script>
{% endblock %}

{% block blog_content %}
    {# Breadcrumb #}
    <nav aria-label="breadcrumb" class="mb-4" data-aos="fade-up">
        <ol class="breadcrumb blog-breadcrumb">
            <li class="breadcrumb-item"><a href="{{ path('blog_index') }}">Blog</a></li>
            {% if post.category %}
                <li class="breadcrumb-item"><a href="{{ path('blog_category', {slug: post.category.slug}) }}">{{ post.category.name }}</a></li>
            {% endif %}
            <li class="breadcrumb-item active" aria-current="page">{{ post.title|u.truncate(50, '...') }}</li>
        </ol>
    </nav>

    {# Article #}
    <article class="blog-post" data-aos="fade-up">
        {# Featured Image #}
        {% if post.featuredImage %}
            <div class="post-featured-image mb-4">
                <img src="{{ post.featuredImage }}" alt="{{ post.title }}" loading="lazy">
            </div>
        {% endif %}

        {# Header #}
        <header class="post-header">
            {% if post.category %}
                <a href="{{ path('blog_category', {slug: post.category.slug}) }}" class="post-category-link">
                    <span class="post-category-badge" style="--badge-color: {{ post.category.color ?? '#6366f1' }}">
                        {{ post.category.name }}
                    </span>
                </a>
            {% endif %}

            <h1 class="post-title">{{ post.title }}</h1>

            <div class="post-meta">
                <div class="post-author">
                    <i class='bx bx-user'></i>
                    <span>{{ post.author.fullName }}</span>
                </div>
                <div class="post-date">
                    <i class='bx bx-calendar'></i>
                    <span>{{ post.publishedAt|date('d F Y') }}</span>
                </div>
                <div class="post-reading-time">
                    <i class='bx bx-time'></i>
                    <span>{{ post.readingTime }} min de lecture</span>
                </div>
            </div>
        </header>

        {# Content #}
        <div class="post-content">
            {{ post.content|raw }}
        </div>

        {# Tags #}
        {% if post.tags|length > 0 %}
            <div class="post-tags">
                <h4>Tags :</h4>
                <div class="tags-list">
                    {% for tag in post.tags %}
                        <a href="{{ path('blog_tag', {slug: tag.slug}) }}" class="tag-badge">
                            {{ tag.name }}
                        </a>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        {# Social Share #}
        <div class="post-share">
            <h4>Partager cet article :</h4>
            <div class="share-buttons">
                <a href="https://twitter.com/intent/tweet?text={{ post.title|url_encode }}&url={{ app.request.uri|url_encode }}"
                   target="_blank" rel="noopener" class="share-btn share-twitter">
                    <i class='bx bxl-twitter'></i> Twitter
                </a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ app.request.uri|url_encode }}"
                   target="_blank" rel="noopener" class="share-btn share-linkedin">
                    <i class='bx bxl-linkedin'></i> LinkedIn
                </a>
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ app.request.uri|url_encode }}"
                   target="_blank" rel="noopener" class="share-btn share-facebook">
                    <i class='bx bxl-facebook'></i> Facebook
                </a>
            </div>
        </div>
    </article>

    {# Related Posts #}
    {% if relatedPosts|length > 0 %}
        <section class="related-posts mt-5" data-aos="fade-up">
            <h2 class="related-posts-title">Articles similaires</h2>
            <div class="related-posts-grid">
                {% for relatedPost in relatedPosts %}
                    {% include 'blog/_partials/_post_card.html.twig' with {post: relatedPost} %}
                {% endfor %}
            </div>
        </section>
    {% endif %}

    {# Back to Blog #}
    <div class="text-center mt-5" data-aos="fade-up">
        <a href="{{ path('blog_index') }}" class="btn-back-to-blog">
            <i class='bx bx-arrow-back'></i> Retour au blog
        </a>
    </div>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        /* Breadcrumb */
        .blog-breadcrumb {
            background: transparent;
            padding: 0;
            margin: 0;
        }

        .blog-breadcrumb .breadcrumb-item {
            color: var(--text-secondary);
        }

        .blog-breadcrumb .breadcrumb-item a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s;
        }

        .blog-breadcrumb .breadcrumb-item a:hover {
            color: var(--primary-color);
        }

        .blog-breadcrumb .breadcrumb-item.active {
            color: var(--text-primary);
        }

        /* Post */
        .blog-post {
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 16px;
            padding: 2rem;
        }

        .post-featured-image {
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
        }

        .post-featured-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        .post-header {
            margin-bottom: 2rem;
        }

        .post-category-link {
            text-decoration: none;
        }

        .post-category-badge {
            display: inline-block;
            padding: 0.375rem 0.875rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--badge-color);
            color: white;
            margin-bottom: 1rem;
        }

        .post-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1.2;
            margin-bottom: 1.5rem;
        }

        .post-meta {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .post-meta > div {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .post-meta i {
            font-size: 1.2rem;
        }

        /* Content */
        .post-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--text-primary);
            margin-bottom: 2rem;
        }

        .post-content h2 {
            font-size: 2rem;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .post-content h3 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .post-content p {
            margin-bottom: 1.5rem;
        }

        .post-content a {
            color: var(--primary-color);
            text-decoration: underline;
        }

        .post-content a:hover {
            color: var(--secondary-color);
        }

        .post-content ul, .post-content ol {
            margin-bottom: 1.5rem;
            padding-left: 2rem;
        }

        .post-content li {
            margin-bottom: 0.5rem;
        }

        .post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .post-content blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: var(--text-secondary);
        }

        .post-content code {
            background: var(--dark-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.9em;
            color: var(--accent-color);
        }

        .post-content pre {
            background: var(--dark-bg);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
        }

        .post-content pre code {
            background: transparent;
            padding: 0;
            color: var(--text-primary);
        }

        /* Tags */
        .post-tags {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--dark-border);
        }

        .post-tags h4 {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            text-decoration: none;
            color: var(--text-secondary);
            border: 1px solid var(--dark-border);
            transition: all 0.3s;
        }

        .tag-badge:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Social Share */
        .post-share {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--dark-border);
        }

        .post-share h4 {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .share-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .share-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .share-twitter {
            background: #1DA1F2;
            color: white;
        }

        .share-twitter:hover {
            background: #1a8cd8;
        }

        .share-linkedin {
            background: #0077B5;
            color: white;
        }

        .share-linkedin:hover {
            background: #005f8d;
        }

        .share-facebook {
            background: #1877F2;
            color: white;
        }

        .share-facebook:hover {
            background: #1460c7;
        }

        /* Related Posts */
        .related-posts-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 2rem;
            text-align: center;
        }

        .related-posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        /* Back to Blog Button */
        .btn-back-to-blog {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-back-to-blog:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .post-title {
                font-size: 1.75rem;
            }

            .blog-post {
                padding: 1.5rem;
            }

            .post-content {
                font-size: 1rem;
            }

            .related-posts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
{% endblock %}
