{% extends 'layouts/base.html.twig' %}

{% block title %}Modifier l'utilisateur{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-12">
            {% include 'components/page_header.html.twig' with {
                title: 'Modifier l\'utilisateur',
                breadcrumb: [
                    {label: 'Administration', path: null},
                    {label: 'Utilisateurs', path: 'admin_users'},
                    {label: 'Modifier', path: null}
                ],
                actions: [
                    {label: 'Retour à la liste', path: 'admin_users', icon: 'bx-arrow-back', class: 'btn-outline-secondary'}
                ]
            } %}
        </div>
    </div>

    <form method="post" enctype="multipart/form-data">
        <div class="row">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="bx bx-user me-2"></i>
                            {{ user.firstName }} {{ user.lastName }} <small class="text-muted">({{ user.email }})</small>
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if user.lastLoginAt %}
                        <div class="alert alert-info mb-3">
                            <strong><i class="bx bx-time-five me-1"></i> Dernière connexion:</strong><br>
                            {{ user.lastLoginAt|date('d/m/Y à H:i:s') }}
                            {% if user.lastLoginIp %}
                                <br><small class="text-muted">IP: {{ user.lastLoginIp }}</small>
                            {% endif %}
                        </div>
                        {% else %}
                        <div class="alert alert-secondary mb-3">
                            <i class="bx bx-info-circle me-1"></i> Aucune connexion enregistrée
                        </div>
                        {% endif %}
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="first_name" class="form-label">Prénom <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="first_name" name="first_name" value="{{ user.firstName }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="last_name" class="form-label">Nom <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="last_name" name="last_name" value="{{ user.lastName }}" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="phone_work" class="form-label">Téléphone professionnel</label>
                                    <input type="tel" class="form-control" id="phone_work" name="phone_work" value="{{ user.phoneWork }}">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="phone_personal" class="form-label">Téléphone personnel</label>
                                    <input type="tel" class="form-control" id="phone_personal" name="phone_personal" value="{{ user.phonePersonal }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="address" class="form-label">Adresse personnelle</label>
                                    <textarea class="form-control" id="address" name="address" rows="3">{{ user.address }}</textarea>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="avatar" class="form-label">Avatar</label>
                            <input type="file" class="form-control" id="avatar" name="avatar" accept="image/*">
                            {% if user.avatar %}
                                <small class="form-text text-muted">Actuel: <a href="{{ user.avatar }}" target="_blank">voir</a></small>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="bx bx-shield me-2"></i>
                            Rôles et permissions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" value="ROLE_INTERVENANT" id="r1" name="roles[]" {% if 'ROLE_INTERVENANT' in user.roles %}checked{% endif %}>
                            <label class="form-check-label" for="r1">Intervenant</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" value="ROLE_CHEF_PROJET" id="r2" name="roles[]" {% if 'ROLE_CHEF_PROJET' in user.roles %}checked{% endif %}>
                            <label class="form-check-label" for="r2">Chef de projet</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" value="ROLE_MANAGER" id="r3" name="roles[]" {% if 'ROLE_MANAGER' in user.roles %}checked{% endif %}>
                            <label class="form-check-label" for="r3">Manager</label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" value="ROLE_SUPERADMIN" id="r4" name="roles[]" {% if 'ROLE_SUPERADMIN' in user.roles %}checked{% endif %}>
                            <label class="form-check-label" for="r4">Super administrateur</label>
                        </div>
                    </div>
                </div>

                {% include 'components/form_buttons.html.twig' with {
                    submit_label: 'Enregistrer',
                    cancel_route: 'admin_users'
                } %}
            </div>
        </div>
    </form>
{% endblock %}
